name: Automated Trading System

on:
  schedule:
    # Run every weekday at 8:30 AM Pakistan time (03:30 UTC)
    - cron: '30 3 * * 1-5'
  
  # Allow manual trigger
  workflow_dispatch:

jobs:
  update_system:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        fetch-depth: 0  # Full history
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        pip install --upgrade pip
        pip install pandas numpy requests tensorflow scikit-learn xgboost
    
    - name: Run automated daily cycle
      run: |
        python automated_system.py
    
    - name: Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action Bot"
        git add .
        git commit -m "Auto-update $(date +'%Y-%m-%d') - Data & Predictions" || echo "No changes"
        git push
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Upload artifacts
      uses: actions/upload-artifact@v3
      with:
        name: daily-reports
        path: |
          reports/trading_signals.csv
          reports/history/*.csv